%function [ output_args ] = messages( bits )
bits([1:87])=0;bits([58,59,60,62,42,44])=1;
%UNTITLED4 此处显示有关此函数的摘要
%   此处显示详细说明
S=[1 2 2 2 2  3 3 3  3  4 4 4  4   5 5  6 6 6  6  7 8 9 9 9  9 ...
10 10 10 10 11 11 11 11 12 12 12 12 13 13 13 14 15 15 15 15 ...
  16 16 16 16 17 17 17 17 18 18 18 19 20 20 20 20 21 21 21 22 ...
22 22 22 23 23 23 23 24 24 24 24 25 26 27 28 29 30 31 32 33 2 2];
E=[2 1 3 9 26 2 4 10 27 3 5 11 28  6 12 4 7 13 29 6 9 2 8 10 ...
15 3  9  11 16 4  10 12 17 5  11 13 18 6  12 24 15  9 14 16 20 ...
  10 15 17 21 11 16 18 22 12 17 23 20 15 19 21 30 16 20 22 17 21 ...
23 31 18 22 24 32 13 23 25 33 24 2  3  4  6  20 22 23 24 34 35];
S1=[S 34 35];E1=[E 2 2];
W(1:length(S1))=1;  
G=sparse(S1,E1,W);
G(34,2)=0;G(35,2)=0;
[Dist]=graphallshortestpaths(G);
x=[0 1 2 3 4 5 6 0 1 2 3 4 5 0 1 2 3 4 0 1 2 3 4 5 6 1 2 3 5 1 3 4 5 1 1.5];
y=[4 4 4 4 4 4 4 3 3 3 3 3 2 2 2 2 2 2 1 1 1 1 1 1 1 5 5 5 5 0 0 0 0 3.5 4];
P=[0.0200 0.0505 0.0377 0.0316 0.0191 0.0342 0.0281 0.0499 0.0268 0.0524...
  0.0208 0.0382 0.0207 0.0336 0.0055 0.0636 0.0588 0.0168 0.0678 0.0200...
  0.0100 0.0236 0.0060 0.0501 0.0330 0.0395 0.0223 0.0490 0.0382 0.0240...
  0.0128 0.0367 0.0308 0.0292 0.0128 0.0312 0.0222 0.0325 0.0147 0.0152...
  0.0100 0.0477 0.0194 0.0642 0.0199 0.0467 0.0383 0.0211 0.0511 0.0218...
  0.0413 0.0224 0.0169 0.0189 0.0272 0.0335 0.0200 0.0432 0.0299 0.0309...
  0.0122 0.0366 0.0156 0.0185 0.0252 0.0227 0.0190 0.0212 0.0323 0.0244...
  0.0173 0.0312 0.0326 0.0336 0.0251 0.0194 0.0200 0.0400 0.0100 0.0200...
  0.0400 0.0400 0.0200 0.0100 0.0200 0.0320 0.0138];   %事件发生率权重
F=[400 505 755 949 955 683 562 499 536 1048 624 765 621 854 55 1273 ... 
    1176 336 1357 800 100 708 60 501 660 395 446 490 382 480 256 367 ...
    617 292 256 312 222 650 295 606 100 954 194 642 598 467 383 423 ...
    511 436 413 448 507 378 272 335 800 1295 1196 1238 488 366 623 ...
    369 504 453 379 424 323 488 346 312 651 672 753 581 800 2000 100 ...
    800 800 2400 400 100 800 640 276];   %路段流量
f(1:length(x))=0;     %从安装起始节点到各节点流入流量
ff(1:length(S))=0;    %从安装路段到各路段流量
k=82;   %安装路段         
s0=S(k);e0=E(k);   %起点终点
dist(1:length(x))=inf;
dist(s0)=0; 
f(s0)=F(k);
for dis=1:length(x)-1;
    for i=1:length(x)
        ix=x(i);iy=y(i);
        if ((Dist(s0,i)==dis) && (((x(e0)>x(s0))&&(ix>=x(e0)))||((x(e0)<x(s0))&&(ix<=x(e0)))||((y(e0)>y(s0))&&(iy>=y(e0)))||((y(e0)<y(s0))&&(iy<=y(e0)))))
            dist(i)=dis;      %可选显示范围内的节点距离，否则为inf
        end
    end
end
for j=0:length(x)-1;
    for i=1:length(x)
        if dist(i)==j
            fz=0;
            for l=1:length(x)
                if dist(l)==j+1 && Dist(i,l)==1
                    for q=1:length(S)
                        if S(q)==i && E(q)==l
                            fz=fz+F(q);
                        end
                    end
                end
            end
            for l=1:length(x)
                if dist(l)==j+1 && Dist(i,l)==1
                    for q=1:length(S)
                        if S(q)==i && E(q)==l
                            f(l)=f(l)+f(i)*F(q)/fz;
                            ff(q)=f(i)*F(q)/fz;
                        end
                    end
                end
            end
        end
    end
end
e(1:length(S))=0;
m(1:length(S))=0;
for i=1:length(S)
    si=S(i);
    if si~=s0
    e(i)=1/dist(si);
    m(i)=e(i)*ff(i)*P(i);
    end
end
m(k)=0;
output_args=0;
for i=1:length(S)
    output_args=output_args+m(i)*bits(i);
end
bit=0;
for i=1:length(S)
    bit=bit+bits(i);
end
if bit~=0
    output_args=output_args/(bit^0.5-1);     %信息获取率与路段数的关系,最少取4个路段
else
    output_args=0;
end

